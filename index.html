<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tin t·ª©c h√¥m nay</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f9f9f9;margin:0;color:#333}
    header{background:#007bff;color:#fff;text-align:center;padding:20px 10px}
    main{max-width:700px;margin:30px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
    img{max-width:100%;border-radius:8px;margin-top:10px}
    h2{color:#007bff}
    footer{text-align:center;color:#777;font-size:14px;margin-top:30px;padding-bottom:20px}

    /* Popup overlay */
    #popupOverlay{
      display:none;
      position:fixed;inset:0;
      background:rgba(0,0,0,.75);
      z-index:9999;
      justify-content:center;align-items:center;
    }
    .popupBox{
      position:relative;
      max-width:90vw;
      max-height:85vh;
      border-radius:12px;
    }
    .popupBox img{display:block;max-width:90vw;max-height:80vh;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.4)}
    #closeBtn{
      position:absolute;top:8px;right:8px;
      width:36px;height:36px;border-radius:50%;border:none;
      background:#ff3b30;color:#fff;font-size:18px;cursor:pointer;
    }

    /* Confirm box (Android non-webview) */
    #confirmOverlay{
      display:none;
      position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:10000;
      justify-content:center;align-items:center;
    }
    .confirmBox{
      background:#fff;padding:18px;border-radius:12px;max-width:320px;text-align:center;box-shadow:0 8px 30px rgba(0,0,0,.25)
    }
    .confirmBox p{margin:0 0 12px;color:#222}
    .confirmActions{display:flex;gap:10px;justify-content:center}
    .btn{padding:8px 14px;border-radius:8px;border:none;cursor:pointer}
    .btnCancel{background:#e0e0e0}
    .btnContinue{background:#007bff;color:#fff}

    @media (max-width:420px){
      .confirmBox{width:86%;padding:14px}
    }
  </style>
</head>
<body>
  <header><h1>Tin t·ª©c m·ªõi nh·∫•t h√¥m nay</h1></header>

  <main>
    <h2>üî• S·ª± vi·ªác g√¢y bucxuc nh·∫•t l√∫c n√†y t·∫°i An Giang </h2>
    <p><em>Ng√†y ƒëƒÉng: 30/10/2025</em></p>
    <img src="https://via.placeholder.com/700x400" alt="·∫¢nh minh h·ªça c·ªßa b√†i vi·∫øt" />
    <video width="640" height="360" controls>
        <source src="vd1.mp4" type="video/mp4" />
    </video>
    <video width="640" height="360" controls>
        <source src="vd2.mp4" type="video/mp4" />
    </video>
    <video width="640" height="360" controls>
        <source src="vd3.mp4" type="video/mp4" />
    </video>
    <p>ƒê√¢y l√† n·ªôi dung b√†i vi·∫øt c·ªßa b·∫°n. B·∫°n c√≥ th·ªÉ thay ti√™u ƒë·ªÅ, ·∫£nh, ho·∫∑c n·ªôi dung t√πy √Ω.</p>
  </main>

  <footer>¬© 2025 TinTuc24h HongBienMoi ‚Äî C·∫≠p nh·∫≠t li√™n t·ª•c m·ªói ng√†y</footer>

  <!-- Popup overlay -->
  <div id="popupOverlay" role="dialog" aria-modal="true">
    <div class="popupBox">
      <button id="closeBtn" aria-label="ƒê√≥ng">‚úï</button>
      <img id="popupImg" src="" alt="Khuy·∫øn m√£i" />
    </div>
  </div>

  <!-- Confirm overlay (Android non-WebView) -->
  <div id="confirmOverlay" role="dialog" aria-modal="true">
    <div class="confirmBox">
      <p>Trang web ƒëang c·ªë m·ªü ·ª©ng d·ª•ng ngo√†i. Nh·∫•n <strong>Ti·∫øp t·ª•c</strong> ƒë·ªÉ m·ªü trong Chrome.</p>
      <div class="confirmActions">
        <button class="btn btnCancel" id="confirmCancel">H·ªßy</button>
        <button class="btn btnContinue" id="confirmContinue">Ti·∫øp t·ª•c</button>
      </div>
    </div>
  </div>

<script>
(function(){
  // Links & images ‚Äî thay ƒë·ªïi theo nhu c·∫ßu c·ªßa b·∫°n
  const flow = [
    {
      id: 'shopee',
      img: 'shopee.jpg', // thay ·∫£nh th·∫≠t
      iosOpen: 'https://s.shopee.vn/9KZpLT2cTE',   // tr√™n iOS d√πng https (universal link)
      androidIntent: 'intent://s.shopee.vn/9KZpLT2cTE#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=https://s.shopee.vn/9KZpLT2cTE;end'
    },
    {
      id: 'tiktok',
      img: 'tiktok.jpg', // thay ·∫£nh th·∫≠t
      iosOpen: 'https://vt.tiktok.com/ZSHv3umBcrxHj-ANnIX/',
      androidIntent: 'intent://vt.tiktok.com/ZSHv3umBcrxHj-ANnIX/#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=https://vt.tiktok.com/ZSHv3umBcrxHj-ANnIX/;end'
    }
  ];

  const popupOverlay = document.getElementById('popupOverlay');
  const popupImg = document.getElementById('popupImg');
  const closeBtn = document.getElementById('closeBtn');

  const confirmOverlay = document.getElementById('confirmOverlay');
  const confirmCancel = document.getElementById('confirmCancel');
  const confirmContinue = document.getElementById('confirmContinue');

  // environment detection
  const ua = navigator.userAgent || '';
  const isAndroid = /android/i.test(ua);
  const isIOS = /iphone|ipad|ipod/i.test(ua);
  // treat common app webviews (facebook / messenger / instagram / tiktok) as webview
  const uaLower = ua.toLowerCase();
  const isWebView = (uaLower.includes('fbav') || uaLower.includes('fbios') || uaLower.includes('instagram') || uaLower.includes('messenger') || uaLower.includes('twitter') || uaLower.includes('tiktok'));

  // popupStep stored as number string
  let step = parseInt(sessionStorage.getItem('popupStep') || '0', 10);

  function showIfNeeded() {
    if (!isAndroid && !isIOS) {
      // desktop: do nothing (keep original behavior - no popup)
      return;
    }
    if (step >= flow.length) return;
    const obj = flow[step];
    popupImg.src = obj.img;
    popupOverlay.style.display = 'flex';
  }

  // ensure on load after rendering (fix Safari timing)
  window.addEventListener('load', () => {
    setTimeout(showIfNeeded, 160); // small delay to avoid race in some webviews
  });

  // Handle close button on popup
  closeBtn.addEventListener('click', () => {
    // hide popup with simple effect
    popupOverlay.style.display = 'none';

    // remember we advanced to next step (so when user returns we show next)
    sessionStorage.setItem('popupStep', String(step + 1));

    // current link
    const current = flow[step];

    // increment local step for running logic (visibilitychange uses sessionStorage)
    step = step + 1;

    // Behavior depends on environment:
    if (isAndroid) {
      // If inside app WebView, try to redirect immediately to Chrome intent (user already interacted)
      if (isWebView) {
        // attempt immediate redirect to Chrome (intent)
        try {
          window.location.href = current.androidIntent;
        } catch (e) {
          // fallback to web url
          window.location.href = current.iosOpen || '';
        }
        return;
      }

      // Not a WebView (regular Chrome) -> show confirm overlay (one click)
      confirmOverlay.style.display = 'flex';
      return;
    }

    if (isIOS) {
      // On iOS we open direct https link (Safari/universal link will open app if set up).
      window.location.href = current.iosOpen;
      return;
    }

    // other platforms: nothing
  });

  // confirm overlay actions (Android non-webview)
  confirmCancel.addEventListener('click', () => {
    confirmOverlay.style.display = 'none';
    // user cancelled: do not change step (we already incremented sessionStorage above)
    // revert sessionStorage so popup can be shown again
    const prev = Math.max(0, step - 1);
    sessionStorage.setItem('popupStep', String(prev));
    step = prev;
    // show the popup again after short delay
    setTimeout(() => { showIfNeeded(); }, 200);
  });

  confirmContinue.addEventListener('click', () => {
    confirmOverlay.style.display = 'none';
    // current was flow[step-1] because we already incremented step earlier
    const index = Math.max(0, step - 1);
    const current = flow[index];
    // redirect via intent to Chrome to allow Chrome to open the app
    try {
      window.location.href = current.androidIntent;
    } catch (e) {
      window.location.href = current.iosOpen || '';
    }
  });

  // When user returns to page after app, show next popup if any
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
      step = parseInt(sessionStorage.getItem('popupStep') || '0', 10);
      if (step < flow.length) {
        // small delay to allow rendering
        setTimeout(() => { showIfNeeded(); }, 200);
      } else {
        // done
        popupOverlay.style.display = 'none';
      }
    }
  });

})();
</script>
</body>
</html>
